<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Token Management</title>
    <!-- é˜²æ­¢é¡µé¢é—ªçƒï¼šåœ¨æ¸²æŸ“å‰æ ¹æ®ç™»å½•çŠ¶æ€å’ŒTabçŠ¶æ€è®¾ç½®åˆå§‹æ˜¾ç¤º -->
    <script>
        (function() {
            var isLoggedIn = localStorage.getItem('authToken');
            var currentTab = localStorage.getItem('currentTab') || 'tokens';
            var classes = ['auth-ready'];
            if (isLoggedIn) classes.push('logged-in');
            if (currentTab === 'settings') classes.push('tab-settings');
            document.documentElement.className = classes.join(' ');
            // æ£€æµ‹å­—ä½“åŠ è½½
            if ('fonts' in document) {
                document.fonts.ready.then(function() {
                    document.documentElement.classList.add('fonts-loaded');
                });
            } else {
                // åå¤‡æ–¹æ¡ˆï¼šå»¶è¿Ÿæ·»åŠ 
                setTimeout(function() {
                    document.documentElement.classList.add('fonts-loaded');
                }, 1000);
            }
        })();
    </script>
    <style>
/* é˜²æ­¢é—ªçƒçš„å…³é”®æ ·å¼ - æ¥è‡ª binary-build */
html:not(.auth-ready) #loginForm,
html:not(.auth-ready) #mainContent { visibility: hidden; }
/* ç™»å½•çŠ¶æ€æ˜¾ç¤ºæ§åˆ¶ - åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯ */
.logged-in #loginForm { display: none !important; }
.logged-in #mainContent { display: flex !important; }
html:not(.logged-in) #mainContent { display: none !important; }
/* TabçŠ¶æ€ç®¡ç† - æ¥è‡ª binary-build */
html.tab-settings #tokensPage { display: none !important; }
html.tab-settings #settingsPage { display: block !important; }
html.tab-settings .tab[data-tab="tokens"] { 
    background: transparent !important;
    color: var(--text-light, #888) !important; 
}
html.tab-settings .tab[data-tab="settings"] { 
    background: var(--primary, #4f46e5) !important; 
    color: white !important; 
}
    </style>
    <!-- ä¸»æ ·å¼è¡¨ - ä¼˜å…ˆåŠ è½½ -->
    <link rel="stylesheet" href="style.css">
    <!-- é¢„è¿æ¥å­—ä½“æœåŠ¡å™¨ -->
    <link rel="preconnect" href="https://font.sec.miui.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- å­—ä½“å¼‚æ­¥åŠ è½½ - ä¸é˜»å¡æ¸²æŸ“ -->
    <link rel="stylesheet" href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap">
    </noscript>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="login-form">
            <h2 data-i18n="app.title">Token Management</h2>
            <form id="login">
                <div class="form-group">
                    <label>ğŸ‘¤ <span data-i18n="app.username">Username</span></label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>ğŸ”‘ <span data-i18n="app.password">Password</span></label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" data-i18n="app.login">Login</button>
            </form>
        </div>

        <!-- ä¸»å†…å®¹ -->
        <div id="mainContent" class="main-content hidden">
            <div class="header">
            <div class="tabs">
                <button class="tab active" data-tab="tokens" onclick="switchTab('tokens')">ğŸ¯ <span data-i18n="tabs.tokens">Token</span></button>
                <button class="tab" data-tab="settings" onclick="switchTab('settings')">âš™ï¸ <span data-i18n="tabs.settings">Settings</span></button>
            </div>
                <div class="header-right">
                    <button onclick="logout()">ğŸšª <span data-i18n="app.logout">Logout</span></button>
                </div>
            </div>
            <div class="content">
                <!-- Tokenç®¡ç†é¡µé¢ -->
                <div id="tokensPage">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® åˆå¹¶ -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item clickable active" onclick="filterTokens('all')">
                                <span class="stat-num" id="totalTokens">0</span>
                                <span class="stat-text" data-i18n="stats.total">Total</span>
                            </div>
                            <div class="stat-item success clickable" onclick="filterTokens('enabled')">
                                <span class="stat-num" id="enabledTokens">0</span>
                                <span class="stat-text" data-i18n="stats.enabled">Enabled</span>
                            </div>
                            <div class="stat-item danger clickable" onclick="filterTokens('disabled')">
                                <span class="stat-num" id="disabledTokens">0</span>
                                <span class="stat-text" data-i18n="stats.disabled">Disabled</span>
                            </div>
                        </div>
                        <div class="action-btns">
                            <button type="button" onclick="showOAuthModal()" class="btn btn-success btn-sm">ğŸ” <span data-i18n="buttons.oauth">OAuth</span></button>
                            <button type="button" onclick="showManualModal()" class="btn btn-secondary btn-sm">âœï¸ <span data-i18n="buttons.manual">Manual</span></button>
                            <button type="button" onclick="loadTokens()" class="btn btn-warning btn-sm">ğŸ”„ <span data-i18n="buttons.refresh">Refresh</span></button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-sm" id="toggleSensitiveBtn" data-i18n-title="tooltips.toggleSensitive">ğŸ‘ï¸ <span data-i18n="buttons.show">Show</span></button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="tokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text" data-i18n="tokens.noTokens">No Tokens</div>
                            <div class="empty-state-hint" data-i18n="tokens.clickOAuthHint">Click OAuth button above to add Token</div>
                        </div>
                    </div>
                </div>

                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settingsPage" class="hidden">
                    <form id="configForm" class="config-form">
                        <div class="config-grid">
                            <!-- æœåŠ¡å™¨é…ç½® -->
                            <div class="config-section">
                                <h4>ğŸ–¥ï¸ <span data-i18n="settings.server">Server</span></h4>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label data-i18n="settings.port">Port</label>
                                        <input type="number" name="PORT" placeholder="8045">
                                    </div>
                                    <div class="form-group compact">
                                        <label data-i18n="settings.host">Listen Address</label>
                                        <input type="text" name="HOST" placeholder="0.0.0.0">
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label data-i18n="settings.maxRequestSize">Max Request Size</label>
                                        <input type="text" name="MAX_REQUEST_SIZE" placeholder="500mb">
                                    </div>
                                    <div class="form-group compact">
                                        <label data-i18n="settings.apiKey">API Key</label>
                                        <input type="password" name="API_KEY" placeholder="">
                                    </div>
                                </div>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label><span data-i18n="settings.skipValidation">Skip Validation</span> <span class="help-tip" data-i18n-tooltip="tooltips.skipProjectId">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="SKIP_PROJECT_ID_FETCH">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="form-group compact switch-group">
                                        <label><span data-i18n="settings.nativeAxios">Native Axios</span> <span class="help-tip" data-i18n-tooltip="tooltips.nativeAxios">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="USE_NATIVE_AXIOS">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label data-i18n="settings.imageUrl">Image URL</label>
                                    <input type="text" name="IMAGE_BASE_URL" placeholder="https://your-domain.zeabur.app">
                                </div>
                                <div class="form-group compact">
                                    <label data-i18n="settings.proxy">Proxy</label>
                                    <input type="text" name="PROXY" placeholder="http://127.0.0.1:7890">
                                </div>
                            </div>

                            <!-- æ¨¡å‹é»˜è®¤å‚æ•° -->
                            <div class="config-section">
                                <h4>ğŸ›ï¸ <span data-i18n="settings.params">Model Parameters</span></h4>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label data-i18n="settings.temperature">Temperature</label>
                                        <input type="number" step="0.1" name="DEFAULT_TEMPERATURE" placeholder="1">
                                    </div>
                                    <div class="form-group compact">
                                        <label>Top P</label>
                                        <input type="number" step="0.01" name="DEFAULT_TOP_P" placeholder="1">
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label>Top K</label>
                                        <input type="number" name="DEFAULT_TOP_K" placeholder="50">
                                    </div>
                                    <div class="form-group compact">
                                        <label data-i18n="settings.maxTokens">Max Tokens</label>
                                        <input type="number" name="DEFAULT_MAX_TOKENS" placeholder="32000">
                                    </div>
                                </div>
                                <div class="form-group compact highlight">
                                    <label><span data-i18n="settings.thinkingBudget">Thinking Budget</span> <span class="help-tip" data-i18n-tooltip="tooltips.thinkingBudget">?</span></label>
                                    <input type="number" name="DEFAULT_THINKING_BUDGET" placeholder="16000">
                                </div>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label><span data-i18n="settings.contextSystem">Context System</span> <span class="help-tip" data-i18n-tooltip="tooltips.contextSystem">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="USE_CONTEXT_SYSTEM_PROMPT">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label data-i18n="settings.systemPrompt">System Prompt</label>
                                    <textarea name="SYSTEM_INSTRUCTION" rows="3" data-i18n-placeholder="settings.systemPromptPlaceholder"></textarea>
                                </div>
                            </div>

                            <!-- è½®è¯¢ç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ– -->
                            <div class="config-section">
                                <h4>ğŸ”„ <span data-i18n="settings.rotation">Rotation & Performance</span></h4>
                                <div class="form-row-inline switch-row">
                                    <div class="form-group compact switch-group">
                                        <label><span data-i18n="settings.passSignature">Pass Signature</span> <span class="help-tip" data-i18n-tooltip="tooltips.passSignature">?</span></label>
                                        <label class="switch">
                                            <input type="checkbox" name="PASS_SIGNATURE_TO_CLIENT">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label><span data-i18n="settings.strategy">Strategy</span> <span class="help-tip" data-i18n-tooltip="tooltips.strategy">?</span></label>
                                        <select name="ROTATION_STRATEGY" id="rotationStrategy" onchange="toggleRequestCountInput()">
                                            <option value="round_robin" data-i18n="settings.roundRobin">Round Robin</option>
                                            <option value="quota_exhausted" data-i18n="settings.quotaExhausted">Quota Exhausted</option>
                                            <option value="request_count" data-i18n="settings.requestCount">Request Count</option>
                                        </select>
                                    </div>
                                    <div class="form-group compact" id="requestCountGroup">
                                        <label><span data-i18n="settings.requestsPerToken">Requests Per Token</span> <span class="help-tip" data-i18n-tooltip="tooltips.requestsPerToken">?</span></label>
                                        <input type="number" name="ROTATION_REQUEST_COUNT" min="1" placeholder="10">
                                    </div>
                                </div>
                                <div class="rotation-status" id="rotationStatus">
                                    <span class="rotation-label" data-i18n="settings.currentStatus">Current Status:</span>
                                    <span id="currentRotationInfo" data-i18n="settings.loading">Loading...</span>
                                </div>
                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label data-i18n="settings.timeout">Timeout (ms)</label>
                                        <input type="number" name="TIMEOUT" placeholder="300000">
                                    </div>
                                    <div class="form-group compact">
                                        <label data-i18n="settings.retryTimes">429 Retry Times</label>
                                        <input type="number" name="RETRY_TIMES" placeholder="0">
                                    </div>
                                </div>

                                <div class="form-row-inline">
                                    <div class="form-group compact">
                                        <label><span data-i18n="settings.heartbeat">Heartbeat (ms)</span> <span class="help-tip" data-i18n-tooltip="tooltips.heartbeat">?</span></label>
                                        <input type="number" name="HEARTBEAT_INTERVAL" placeholder="15000">
                                    </div>
                                    <div class="form-group compact">
                                        <label><span data-i18n="settings.memoryThreshold">Memory (MB)</span> <span class="help-tip" data-i18n-tooltip="tooltips.memoryThreshold">?</span></label>
                                        <input type="number" name="MEMORY_THRESHOLD" placeholder="100">
                                    </div>
                                </div>
                                <div class="form-group compact">
                                    <label>ğŸ”¤ <span data-i18n="settings.fontSize">Font Size (px)</span></label>
                                    <div class="font-size-control">
                                        <input type="range" id="fontSizeRange" min="10" max="24" value="18" oninput="changeFontSize(this.value)">
                                        <input type="number" id="fontSizeInput" min="10" max="24" value="18" onchange="changeFontSize(this.value)" style="width: 60px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="config-actions">
                            <button type="submit" class="btn btn-success">ğŸ’¾ <span data-i18n="buttons.save">Save Config</span></button>
                            <button type="button" onclick="loadConfig()" class="btn btn-secondary">ğŸ”„ <span data-i18n="buttons.reload">Reload</span></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- i18n module - load first -->
    <script src="js/i18n.js" defer></script>
    <!-- æŒ‰ä¾èµ–é¡ºåºåŠ è½½æ¨¡å— -->
    <script src="js/utils.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/quota.js" defer></script>
    <script src="js/tokens.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/main.js" defer></script>
</body>
</html>
